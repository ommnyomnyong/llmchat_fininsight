import React, { useState } from "react";
import Sidebar from "./components/Sidebar";
import ChatWindow from "./components/ChatWindow";

export default function ChatPage() {
  const [collapsed, setCollapsed] = useState(false);
  const [account, setAccount] = useState({
    name: "홍길동",
    googleEmail: "honggildong@gmail.com",
    profileUrl: "",
  });
  const [projects, setProjects] = useState([]);
  const [chats, setChats] = useState([{ id: 1, name: "현재 대화" }]);
  const [selectedProjectId, setSelectedProjectId] = useState(null);
  const [selectedChatId, setSelectedChatId] = useState(1);

  const handleCreateProject = (data) => {
    const newProject = { id: Date.now(), ...data };
    setProjects((prev) => [...prev, newProject]);
  };

  const handleRenameProject = (id, patch) => {
    setProjects((prev) =>
      prev.map((p) => (p.id === id ? { ...p, ...patch } : p))
    );
  };

  const handleDeleteProject = (id) => {
    setProjects((prev) => prev.filter((p) => p.id !== id));
  };

  const handleCreateChat = () => {
    const newChat = {
      id: Date.now(),
      name: `새 채팅 ${chats.length + 1}`,
      projectId: selectedProjectId,
    };
    setChats((prev) => [...prev, newChat]);
    setSelectedChatId(newChat.id);
  };

  const handleRenameChat = (id, patch) => {
    setChats((prev) =>
      prev.map((c) => (c.id === id ? { ...c, ...patch } : c))
    );
  };

  const handleDeleteChat = (id) => {
    setChats((prev) => prev.filter((c) => c.id !== id));
  };

  return (
    <div style={{ display: "flex", height: "100vh", width: "100vw", overflow: "hidden", background: "#fff" }}>
      <Sidebar
        collapsed={collapsed}
        onToggleCollapse={() => setCollapsed((v) => !v)}
        account={account}
        onSaveAccount={setAccount}
        projects={projects}
        chats={chats}
        selectedProjectId={selectedProjectId}
        selectedChatId={selectedChatId}
        onSelectProject={setSelectedProjectId}
        onSelectChat={setSelectedChatId}
        onCreateProject={handleCreateProject}
        onRenameProject={handleRenameProject}
        onDeleteProject={handleDeleteProject}
        onCreateChat={handleCreateChat}
        onRenameChat={handleRenameChat}
        onDeleteChat={handleDeleteChat}
      />

      <div style={{ flex: 1, display: "flex", flexDirection: "column", backgroundColor: "#fff" }}>
        <ChatWindow
          selectedChatId={selectedChatId}
          chats={chats}
          currentChat={chats.find((c) => c.id === selectedChatId)}
          onUpdateChat={(id, updatedData) =>
            setChats((prev) =>
              prev.map((c) => (c.id === id ? { ...c, ...updatedData } : c))
            )
          }
        />
      </div>
    </div>
  );
}
